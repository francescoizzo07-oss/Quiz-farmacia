<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulatore Farmaceutico</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #2f3e4e;
  color: #fff;
}
.container {
  max-width: 720px;
  margin: auto;
  padding: 16px;
}
.card {
  background: #3b4a5a;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
}
h2, h3 {
  margin-top: 0;
}
label {
  display: block;
  margin: 10px 0;
}
button {
  padding: 14px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
}
button.primary {
  width: 100%;
  background: #7fb7ff;
  color: #000;
  font-weight: bold;
}
.option {
  background: #fff;
  color: #000;
  padding: 14px;
  border-radius: 10px;
  margin: 10px 0;
}
.option.correct { background: #9be7a1; }
.option.wrong { background: #f7a3a3; }

.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.bottombar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #1f2a36;
  display: flex;
  justify-content: space-between;
  padding: 10px 20px;
}
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: none;
  align-items: center;
  justify-content: center;
}
.modal-content {
  background: #fff;
  color: #000;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
}
textarea {
  width: 100%;
  min-height: 100px;
}
</style>
</head>

<body>

<!-- MENU -->
<div id="menu" class="container">
  <h2>Configurazione</h2>

<div class="card">
  <h3>Livello di preparazione</h3>

  <label><input type="checkbox" value="le_sai"> Le sai <span id="c_le_sai">0</span></label>
  <label><input type="checkbox" value="ancora_sforzo"> Ancora un piccolo sforzo <span id="c_sforzo">0</span></label>
  <label><input type="checkbox" value="ripetile"> Ripetile <span id="c_ripetile">0</span></label>
  <label><input type="checkbox" value="non_le_sai"> Non le sai <span id="c_non_le_sai">0</span></label>
  <label><input type="checkbox" value="non_risposte" checked> Non risposte <span id="c_non_risposte">0</span></label>
  <label><input type="checkbox" value="tutte"> Tutte <span id="c_tutte">0</span></label>
</div>

<div class="card">
  <h3>Ordinamento dei quiz</h3>

  <strong>Domande</strong>
  <label><input type="radio" name="orderQuestions" value="random" checked> Casuale</label>
  <label><input type="radio" name="orderQuestions" value="alphabetic"> Alfabetico</label>
  <label><input type="radio" name="orderQuestions" value="official"> Ufficiale</label>

  <br>

  <strong>Risposte</strong>
  <label><input type="radio" name="orderAnswers" value="random" checked> Casuale</label>
  <label><input type="radio" name="orderAnswers" value="official"> Ufficiale</label>
  <label><input type="radio" name="orderAnswers" value="onlyCorrect"> Solo risposta esatta</label>
</div>

  <div class="card">
    <h3>Modalit√†</h3>
    <label><input type="radio" name="mode" value="study" checked> Esercizio</label>
    <label><input type="radio" name="mode" value="exam"> Simulazione esame</label>
  </div>

  <button class="primary" onclick="start()">AVVIA</button>
</div>

<!-- QUIZ -->
<div id="quiz" class="container" style="display:none">

  <div class="topbar">
    <button onclick="goMenu()">‚¨ÖÔ∏è</button>
    <div id="status"></div>
  </div>

  <h3 id="progress"></h3>
  <div id="question"></div>
  <div id="options"></div>
</div>

<div class="bottombar" id="nav" style="display:none">
  <button onclick="prev()">‚¨ÖÔ∏è</button>
  <button onclick="openNote()">üìù</button>
  <button onclick="next()">‚û°Ô∏è</button>
</div>

<!-- NOTE -->
<div class="modal" id="noteModal">
  <div class="modal-content">
    <h3>Nota personale</h3>
    <textarea id="noteBox"></textarea>
    <button onclick="saveNote()">Salva</button>
    <button onclick="deleteNote()">Cancella</button>
    <button onclick="closeNote()">Torna alla domanda</button>
  </div>
</div>

<script>
/* DATABASE DI ESEMPIO */
const db = [
  {id:1,q:"Il paracetamolo √®:",o:["Antibiotico","Analgesico","Antivirale"],a:1},
  {id:2,q:"Il diclofenac √® un:",o:["Oppioide","FANS","Cortisonico"],a:1}
];

let questions=[],i=0,mode="study",ok=0,ko=0,answered={};
const NOTES="quizNotes";

/* START */
function start(){
  mode=document.querySelector("input[name=mode]:checked").value;
  questions=[...db];

  if(mode==="exam"){
    questions=shuffle(questions).slice(0,100);
    startTimer(30*60);
  } else {
    if(document.getElementById("orderQuestions").value==="random")
      shuffle(questions);
    if(document.getElementById("orderQuestions").value==="alphabetic")
      questions.sort((a,b)=>a.q.localeCompare(b.q));
  }

  document.getElementById("menu").style.display="none";
  document.getElementById("quiz").style.display="block";
  document.getElementById("nav").style.display=mode==="study"?"flex":"none";
  i=0;ok=0;ko=0;answered={};
  load();
}

function load(){
  const q=questions[i];
  document.getElementById("progress").innerText=`Domanda ${i+1}/${questions.length}`;
  document.getElementById("status").innerText=`‚úîÔ∏è ${ok} ‚ùå ${ko}`;
  document.getElementById("question").innerHTML="<b>"+q.q+"</b>";
  const box=document.getElementById("options");
  box.innerHTML="";
  let opts=[...q.o];
  if(mode==="exam" || document.getElementById("orderAnswers").value==="random")
    shuffle(opts);

  opts.forEach(txt=>{
    const d=document.createElement("div");
    d.className="option";
    d.innerText=txt;
    d.onclick=()=>answer(q,txt,d,opts);
    box.appendChild(d);
  });
}

function answer(q,txt,el,opts){
  if(answered[q.id])return;
  answered[q.id]=true;
  const correct=q.o[q.a];

  document.querySelectorAll(".option").forEach(o=>{
    if(o.innerText===correct) o.classList.add("correct");
  });

  if(txt===correct){ok++;} else {el.classList.add("wrong");ko++;}
  document.getElementById("status").innerText=`‚úîÔ∏è ${ok} ‚ùå ${ko}`;
}

function prev(){if(i>0){i--;load();}}
function next(){if(i<questions.length-1){i++;load();}}
function goMenu(){location.reload();}

/* NOTE */
function openNote(){
  const n=JSON.parse(localStorage.getItem(NOTES))||{};
  document.getElementById("noteBox").value=n[questions[i].id]||"";
  document.getElementById("noteModal").style.display="flex";
}
function closeNote(){document.getElementById("noteModal").style.display="none";}
function saveNote(){
  const n=JSON.parse(localStorage.getItem(NOTES))||{};
  n[questions[i].id]=document.getElementById("noteBox").value;
  localStorage.setItem(NOTES,JSON.stringify(n));
}
function deleteNote(){
  const n=JSON.parse(localStorage.getItem(NOTES))||{};
  delete n[questions[i].id];
  localStorage.setItem(NOTES,JSON.stringify(n));
  document.getElementById("noteBox").value="";
}

/* TIMER */
let t;
function startTimer(s){
  t=setInterval(()=>{
    s--;
    document.getElementById("status").innerText=`‚è± ${Math.floor(s/60)}:${("0"+s%60).slice(-2)}`;
    if(s<=0){clearInterval(t);alert("Tempo scaduto");}
  },1000);
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
</script>

</body>
</html>
