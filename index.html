<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulatore Farmaceutico</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2c7be5">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: #f4f4f4;
}
#config, #quiz {
  max-width: 720px;
  margin: auto;
  padding: 12px;
}
.option {
  background: #fff;
  padding: 14px;
  margin: 10px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
}
button {
  padding: 12px;
  font-size: 16px;
}
.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #fff;
  border-top: 1px solid #ccc;
  display: flex;
  justify-content: space-between;
  padding: 10px 20px;
}
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #fff;
  padding: 20px;
  width: 90%;
  max-width: 400px;
  border-radius: 8px;
}
textarea {
  width: 100%;
  min-height: 100px;
}
</style>
</head>

<body onload="initApp()">

<!-- MENU -->
<div id="config">
  <h2>Menu principale</h2>

  <h3>Ordine</h3>
  <label>Domande:
    <select id="orderQuestions">
      <option value="random">Casuale</option>
      <option value="sequential">Sequenziale</option>
    </select>
  </label><br><br>

  <label>Risposte:
    <select id="orderAnswers">
      <option value="fixed">Fisso</option>
      <option value="random">Casuale</option>
    </select>
  </label>

  <h3>Livello</h3>
  <label><input type="checkbox" value="tutte" checked> Tutte</label><br><br>

  <button onclick="startStudy()">üìò Avvia Studio</button>
</div>

<!-- QUIZ -->
<div id="quiz" style="display:none">

  <!-- TOP -->
  <div class="top-bar">
    <button onclick="goToMenu()">‚¨ÖÔ∏è</button>
    <div>‚úîÔ∏è <span id="okCount">0</span> | ‚ùå <span id="koCount">0</span></div>
  </div>

  <h3 id="quiz-header"></h3>
  <div id="quiz-question"></div>
  <div id="quiz-options"></div>
</div>

<!-- BOTTOM -->
<div class="bottom-bar" id="navBar" style="display:none">
  <button onclick="prevQuestion()">‚¨ÖÔ∏è</button>
  <button onclick="openNote()">üìù</button>
  <button onclick="nextQuestion()">‚û°Ô∏è</button>
</div>

<!-- MODAL NOTE -->
<div class="modal" id="noteModal">
  <div class="modal-content">
    <h3>Nota personale</h3>
    <textarea id="noteBox"></textarea>
    <button onclick="saveNote()">üíæ Salva</button>
    <button onclick="deleteNote()">üóë Cancella</button>
    <button onclick="closeNote()">‚¨ÖÔ∏è Torna alla domanda</button>
  </div>
</div>

<script>
const database = [
  {id:1,q:"Il paracetamolo √®:",options:["Antibiotico","Analgesico","Antivirale"],a:1},
  {id:2,q:"Il diclofenac √® un:",options:["Oppioide","FANS","Cortisonico"],a:1}
];

let quizQuestions=[],currentIndex=0;
let sessionCorrect=0,sessionWrong=0,answered={};

const NOTES_KEY="quizNotes";

function initApp(){}

function startStudy(){
  quizQuestions=[...database];
  if(document.getElementById("orderQuestions").value==="random") shuffle(quizQuestions);
  currentIndex=0;
  sessionCorrect=0;sessionWrong=0;answered={};
  document.getElementById("config").style.display="none";
  document.getElementById("quiz").style.display="block";
  document.getElementById("navBar").style.display="flex";
  loadQuestion();
}

function loadQuestion(){
  const q=quizQuestions[currentIndex];
  document.getElementById("quiz-header").innerText=`Domanda ${currentIndex+1}/${quizQuestions.length}`;
  document.getElementById("quiz-question").innerHTML="<b>"+q.q+"</b>";
  const opts=document.getElementById("quiz-options");
  opts.innerHTML="";
  let answers=[...q.options];
  if(document.getElementById("orderAnswers").value==="random") shuffle(answers);
  answers.forEach(o=>{
    const d=document.createElement("div");
    d.className="option";
    d.innerText=o;
    d.onclick=()=>answer(q,o,d);
    opts.appendChild(d);
  });
}

function answer(q,text,el){
  if(answered[q.id])return;
  answered[q.id]=true;
  const correct=q.options[q.a]===text;
  el.style.background=correct?"#c8f7c5":"#f7c5c5";
  correct?sessionCorrect++:sessionWrong++;
  document.getElementById("okCount").innerText=sessionCorrect;
  document.getElementById("koCount").innerText=sessionWrong;
}

function prevQuestion(){if(currentIndex>0){currentIndex--;loadQuestion();}}
function nextQuestion(){if(currentIndex<quizQuestions.length-1){currentIndex++;loadQuestion();}}

function goToMenu(){location.reload();}

// NOTE
function openNote(){
  const notes=JSON.parse(localStorage.getItem(NOTES_KEY))||{};
  document.getElementById("noteBox").value=notes[quizQuestions[currentIndex].id]||"";
  document.getElementById("noteModal").style.display="flex";
}
function closeNote(){document.getElementById("noteModal").style.display="none";}
function saveNote(){
  const notes=JSON.parse(localStorage.getItem(NOTES_KEY))||{};
  notes[quizQuestions[currentIndex].id]=document.getElementById("noteBox").value;
  localStorage.setItem(NOTES_KEY,JSON.stringify(notes));
}
function deleteNote(){
  const notes=JSON.parse(localStorage.getItem(NOTES_KEY))||{};
  delete notes[quizQuestions[currentIndex].id];
  localStorage.setItem(NOTES_KEY,JSON.stringify(notes));
  document.getElementById("noteBox").value="";
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
</script>

</body>
</html>
 

